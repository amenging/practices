<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>^-^</title>
  </head>
 
  <body onload="main()">
    <canvas id="webgl" width="400" height="400">
    Please use a browser that supports "canvas"
    </canvas>

    <script src="./lib/webgl-utils.js"></script>
    <script src="./lib/webgl-debug.js"></script>
    <script src="./lib/cuon-utils.js"></script>
    <script src="./lib/cuon-matrix.js"></script>
    <script>
      function main () {
        let vShader = `
          attribute vec4 a_Position;
          attribute float a_PointSize;
          attribute vec4 a_Color;
          varying vec4 v_Color;

          void main () {
            gl_Position = a_Position;
            gl_PointSize = a_PointSize;
            v_Color = a_Color;
          }
        `

        let fShader = `
          precision mediump float;
          uniform vec4 u_FragColor;
          varying vec4 v_Color;

          void main () {
            gl_FragColor = v_Color;
          }
        `

        const canvas = document.getElementById('webgl')

        const gl = getWebGLContext(canvas, true)

        gl.clearColor(0, 0, 0, .5)
        gl.clear(gl.COLOR_BUFFER_BIT)

        initShaders(gl, vShader, fShader) // 此处创建gl.program

        let a_Position = gl.getAttribLocation(gl.program, 'a_Position')
        let a_PointSize = gl.getAttribLocation(gl.program, 'a_PointSize')
        let a_Color = gl.getAttribLocation(gl.program, 'a_Color')

        let verticesSizesColors = new Float32Array([
          0.0, 0.5, 10.0, 1.0, 0.0, 0.0, // first point
          -0.5, -0.5, 20.0, 0.0, 1.0, 0.0, // second point
          0.5, -0.5, 30.0, 0.0, 0.0, 1.0 // ...
        ])

        let FSIZE = verticesSizesColors.BYTES_PER_ELEMENT   

        console.log(FSIZE)

        let vertexBuffer = gl.createBuffer()

        gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer)
        gl.bufferData(gl.ARRAY_BUFFER, verticesSizesColors, gl.STATIC_DRAW)

        gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, FSIZE * 6, 0)
        gl.enableVertexAttribArray(a_Position)

        gl.vertexAttribPointer(a_PointSize, 1, gl.FLOAT, false, FSIZE * 6, FSIZE * 2)
        gl.enableVertexAttribArray(a_PointSize)

        gl.vertexAttribPointer(a_Color, 3, gl.FLOAT, false, FSIZE * 6, FSIZE * 3)
        gl.enableVertexAttribArray(a_Color)

        gl.drawArrays(gl.TRIANGLES, 0, 3)
      }
    </script>
  </body>
</html>
